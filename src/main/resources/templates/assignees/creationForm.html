<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>担当者追加 - Issue Management</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body class="bg-base-100 min-h-screen">
  <!-- ナビゲーション -->
  <div class="navbar bg-primary text-primary-content">
    <div class="navbar-start">
      <a class="btn btn-ghost text-xl" th:href="@{/}">Issue Management</a>
    </div>
    <div class="navbar-center">
      <ul class="menu menu-horizontal px-1">
        <li><a th:href="@{/issues}">課題一覧</a></li>
        <li><a th:href="@{/assignees}">担当者一覧</a></li>
      </ul>
    </div>
    <div class="navbar-end">
      <form th:action="@{/logout}" method="post" class="inline">
        <button type="submit" class="btn btn-ghost">ログアウト</button>
      </form>
    </div>
  </div>

  <!-- メインコンテンツ -->
  <div class="container mx-auto px-4 py-8 max-w-2xl">
    <div class="mb-6">
      <h1 class="text-3xl font-bold mb-2">新しい担当者を追加</h1>
      <div class="breadcrumbs text-sm">
        <ul>
          <li><a th:href="@{/assignees}">担当者一覧</a></li>
          <li>新規追加</li>
        </ul>
      </div>
    </div>

    <!-- フォーム -->
    <div class="card bg-base-200 shadow-xl">
      <div class="card-body">
        <form th:action="@{/assignees}" th:object="${assigneeForm}" method="post">
          <!-- 担当者名 -->
          <div class="form-control mb-4">
            <label class="label" for="name">
              <span class="label-text font-semibold">担当者名 <span class="text-error">*</span></span>
            </label>
            <input type="text" id="name" th:field="*{name}" class="input input-bordered w-full" th:classappend="${#fields.hasErrors('name')} ? 'input-error' : ''" placeholder="担当者の名前を入力してください" />
            <div th:if="${#fields.hasErrors('name')}" class="label">
              <span class="label-text-alt text-error" th:errors="*{name}">エラーメッセージ</span>
            </div>
          </div>

          <!-- 写真URL -->
          <div class="form-control mb-6">
            <label class="label" for="photoUrl">
              <span class="label-text font-semibold">写真URL <span class="text-error">*</span></span>
            </label>
            <input type="text" id="photoUrl" th:field="*{photoUrl}" class="input input-bordered w-full" th:classappend="${#fields.hasErrors('photoUrl')} ? 'input-error' : ''" placeholder="/images/avatars/example.png" />
            <div class="label">
              <span class="label-text-alt">例: /images/avatars/isaac-castillejos-VOQkzFIkF0Y-unsplash.png</span>
            </div>
            <div th:if="${#fields.hasErrors('photoUrl')}" class="label">
              <span class="label-text-alt text-error" th:errors="*{photoUrl}">エラーメッセージ</span>
            </div>
          </div>

          <!-- プレビュー -->
          <div class="form-control mb-6">
            <label class="label">
              <span class="label-text font-semibold">プレビュー</span>
            </label>
            <div class="card bg-base-100 shadow-sm p-4">
              <div class="flex items-center space-x-4">
                <div class="avatar">
                  <div class="w-16 rounded-full">
                    <img id="preview-image" th:src="${assigneeForm.photoUrl != null && !assigneeForm.photoUrl.isEmpty()} ? ${assigneeForm.photoUrl} : '/images/avatars/default.png'" alt="プレビュー" class="object-cover" onerror="this.src='/images/avatars/default.png'" />
                  </div>
                </div>
                <div>
                  <div class="font-semibold" id="preview-name" th:text="${assigneeForm.name != null && !assigneeForm.name.isEmpty()} ? ${assigneeForm.name} : '担当者名'">担当者名</div>
                  <div class="text-sm text-base-content/70">担当者</div>
                </div>
              </div>
            </div>
          </div>

          <!-- ボタン -->
          <div class="card-actions justify-end">
            <a th:href="@{/assignees}" class="btn btn-outline">キャンセル</a>
            <button type="submit" class="btn btn-primary">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              担当者を追加
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- JavaScript for live preview -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const nameInput = document.getElementById('name');
      const photoUrlInput = document.getElementById('photoUrl');
      const previewName = document.getElementById('preview-name');
      const previewImage = document.getElementById('preview-image');

      nameInput.addEventListener('input', function () {
        previewName.textContent = this.value || '担当者名';
      });

      photoUrlInput.addEventListener('input', function () {
        if (this.value) {
          previewImage.src = this.value;
        } else {
          previewImage.src = '/images/avatars/default.png';
        }
      });
    });
  </script>
</body>

</html>